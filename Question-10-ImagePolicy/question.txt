Weight: 7%
Domain: Supply Chain Security (20%)
Difficulty: Medium-Hard

Context:
A team attempted to configure the ImagePolicyWebhook admission controller but left
the configuration incomplete. The configuration files exist at /etc/kubernetes/epconfig/
but contain errors and missing values that need to be fixed.

Task:
Fix and complete the existing ImagePolicyWebhook configuration:

1. Review and fix /etc/kubernetes/epconfig/admission_config.yaml:
   - Change `defaultAllow` from `true` to `false` (fail-closed for security)
   - Verify the kubeConfigFile path is correct

2. Review and fix /etc/kubernetes/epconfig/kubeconfig.yaml:
   - Set the `server` URL to: https://image-policy-webhook.default.svc:443/image_policy
     (currently set to a placeholder value)
   - Ensure `current-context` is set to `default`

3. Enable the ImagePolicyWebhook admission controller in the API server:
   - Add `ImagePolicyWebhook` to the `--enable-admission-plugins` flag
   - Set `--admission-control-config-file` to `/etc/kubernetes/epconfig/admission_config.yaml`
   - Add the required volume and volumeMount for `/etc/kubernetes/epconfig`

4. Wait for the API server to restart and verify it's running

5. Test the ImagePolicyWebhook is working:
   - Try to create a test pod: `kubectl run test-pod --image=nginx`
   - The pod creation should be DENIED (because defaultAllow=false and webhook is unreachable)
   - Save the error message to: `/opt/course/10/webhook-test.txt`
   - This confirms the fail-closed behavior is working correctly

Save corrected copies to:
- /opt/course/10/admission_config.yaml
- /opt/course/10/kubeconfig.yaml
- /opt/course/10/webhook-test.txt (error message from test pod creation)
